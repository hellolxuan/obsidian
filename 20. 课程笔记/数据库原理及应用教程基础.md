---
title: 数据库原理及应用教程基础
tags: 
 - 数据库
 - 知识
author: Lxuan
thumbnail:
cover:
toc: true
keywords: 数据库
categories: 学习
top:
---

### 数据库系统概述

1. 数据管理经过了三个发展阶段：<u>人工管理、文件系统和数据库系统</u>

   人工管理阶段数据没有专门的存取设备，没有专门的管理软件、数据不共享、数据不具有独立性

   > 独立性有物理独立性和逻辑独立性
   > > 物理独立性指物理结构（存储结构、外部存储设备）发生变化，通过修改映射，用户逻辑结构和应用程序不改变
   > > 逻辑独立性指逻辑结构（修改数据定义、增加数据类型）发生变化，通过修改映射，用户逻辑结构和应用程序不改变

   文件系统阶段数据以文件形式长期保存，有程序与数据之间有独立性，数据有一定共享性

   数据库系统阶段数据结构化，数据共享型高，独立性高，有统一的数据管理和控制功能

   > 数据控制功能：数据的安全性控制、完整性控制、并发控制、数据恢复
   
2. 数据库的组成：<u>数据库、用户、软件系统、硬件系统</u>

   > 第一类用户：最终用户->非计算机专业人员
   >
   > 第二类用户：应用程序员->调试和安装
   >
   > 第三类用户：数据库管理员->设计、管理、维护数据库，协调用户

3. 三级模式：外模式、模式、内模式

   <u>外模式/模式</u>映像，描述数据的全局<u>逻辑</u>结构
   
   <u>模式/内模式</u>映像，描述数据的全局<u>物理</u>结构
   
   > 二级映像的优点：保证数据的独立性、简化了用户接口、有利于数据共享、有利于数据的安全保密

4. 数据库管理系统（DBMS）

   DBMS是数据库系统的<u>核心</u>组成部分，包括<u>定义、查询、更新（插入、删除和修改）及各种控制</u>
   
   DBMS主要功能：<u>数据定义功能、数据操操纵功能、数据库运行管理功能、数据库的建立和维护功能、数据通信接口及数据组织、存储和管理功能</u>
   
   > 数据库运行管理是DBMS运行的核心部分

5. 数据模型的组成要素

   <u>数据结构、数据操作、数据的完整性约束</u>

   > 数据结构：<u>层次结构、网状结构、关系结构</u>
   >
   > 数据操作有查询和更新（插入、删除和修改）
   >
   > 完整性约束保证数据正确、有效、相容

6. 四种数据模型

   <u>层次模型、网状模型、关系模型、面向对象模型</u>


------



### 关系数据库标准语言——SQL

1. 数据表中数据的操纵
   * 添加表中数据，INSERT INTO

       ~~~sql
       /*在 S 表中添加一条学生记录*/
       INSERT INTO S (sno, sn, age, sex, dept)
       VALUES ('s1', '张三', 20, '男', '计算机')
       ~~~
       
       
       ~~~sql
       /*添加多行记录
       INSERT INTO 表名
       子查询*/
       INSERT INTO S
       SELECT dept, AVG(sal)
       FROM T
       GROUP BY dept
       ~~~
       
   * 修改表中数据，UPDATE
   
       ~~~sql
       UPDATE T
       SET dept='会计'
       WHERE TN='刘伟'
       ~~~
       
   * 删除数据，DELETE
   
       ```sql
       DELETE
       FROM S
       WHERE sn='张三'
       ```
   
       

2. 视图

   视图通常<u>用来简化用户操作，使用户以多种角度看待同一数据</u>

   <u>视图可以用作安全机制，允许用户通过视图访问数据，而不授予访问数据表的权限，**视图本身并不包含数据，保存的是查询语句**</u>
   
   视图对重构数据库提供了一定程度的逻辑独立性，更清晰的表达查询

------



### 数据库安全保护

1. 数据库安全性的含义

   数据库的安全性是指<u>保护数据库以防止非法使用所造成的数据泄露、更改或破坏</u>

2. 数据库完整性的含义

   数据库的完整性是指<u>保护数据库中数据的正确性、有效性和相容性，防止错误的数据进入数据库造成无效操作</u>

   > 实时数据库完整性的方法有：<u>约束、默认值、规则、存储过程和触发器</u>

3. 事务

   事务是数据库中执行的一个工作单位，可以是一组或一条SQL语句、整个程序
   
   定义事务的语句有三条
   
   ```sql
   BEGIN TRANSACTION
   COMMIT
   ROLLBACK
   其中BEGIN TRANSACTION表示事务的开始；
   COMMIT表示事务的提交，正常结束；
   ROLLBACK表示事务的回滚，即运行过程中发生了某种故障，回滚到开始状态
   ```
   
   事务有四个特征：<u>原子性、一致性、隔离性、持久性</u>

4. 并发操作与数据的不一致性

   数据库的并发操作导致的数据库不一致性主要有三种：<u>丢失更新、污读、不可重读</u>

5. 封锁

   封锁类型：<u>排他型封锁、共享性封锁</u>

   封锁协议：

   > 一级封锁协议（不能防止“污读”和“不可重读”）
   >
   > 二级封锁协议（能防止“污读”，不能防止“不可重读”）
   >
   > 三级封锁协议（既能防止“污读”，也能防止“不可重读”）

   封锁粒度：封锁的数据对象大小称为封锁粒度，封锁粒度越小能够被封锁的对象就越多，并发度越高，烦封锁机构越复杂，系统开销也越大，反之亦然，选择封锁粒度时应考虑封锁机构和并发度两个因素，以求得最优解。

6. 活锁和死锁

   死锁产生的条件：

   > 互斥条件：一个对象只能被一个事务使用，即对数据的封锁采用排他式
   >
   > 不可抢占条件：一个数据对象只能被占有它的事务所释放，而不能被别的事务强行抢占
   >
   > 部分分配条件：一个事务已经封锁分给它的数据对象，但仍然要求封锁其他数据
   >
   > 循环等待条件：允许等待其他事务释放数据对象，系统处于加锁请求互相等待的状态

   死锁的预防：一次加锁法、顺序加锁法

   死锁的诊断与解除：<u>选择一个处理死锁代价最小的事务，将它撤销，解除它的死锁，释放此事务占用的所有数据资源，分配给其他事务</u>

------

### 数据库设计

1. 数据库设计步骤：<u>系统需求分析、概念结构设计、逻辑结构设计、物理结构设计、数据库实施、数据库运行和维护</u>

------

### SQL Server高级应用

1. 触发器是一种特殊的存储过程，但触发器能够自动执行并且不含有参数

2. 触发器的种类：

   > <u>DML触发器</u>：DML触发器是在执行数据操作语言（DML）事件时被激活而自动执行的触发器
   >
   > 根据触发器代码执行的时机，DML触发器可以分为两种：<u>After触发器和Instead of触发器</u>
   >
   > > After触发器是在执行了INSTERT、UPDATE或DELETE语句操作之后激活执行的触发器，也是就在记录已经变完之后（After）才会激活执行，这种触发器只能在表上定义，不能在视图上
   > >
   > > Instead of触发器是在执行INSTERT、UPDATE或DELETE语句操作之前激活执行的触发器，也就是记录变更之前，不去执行SQL语句里插入、修改或删除操作，而去执行触发器种的代码所定义的操作，可以定义在表和视图上
   >
   > <u>DDL触发器</u>：DDL触发器是在响应各种数据定义语言（DDL）事件时而激活执行的存储过程
   >
   > <u>登陆触发器</u>：由登陆（LOGON）事件而激活的触发器，建立用户会话时将引发此事件 

3. 每个触发器都有两个特殊表：<u>插入表（Inserted）和删除表（Deleted）</u>，这两个表都是系统在线生成的、动态驻留在内存种的临时表，是由系统管理的逻辑表

4. 备份和还原

   备份类型：<u>数据库完整备份、差异备份、事务日志备份、文件及文件组备份</u>

   还原模式：简单还原、完全还原、批日志还原

